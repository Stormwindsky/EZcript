<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZcript | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --card: #111111;
            --primary: #00f2ff;
            --accent: #7000ff;
            --text: #ffffff;
            --text-dim: #666;
            --border: #222;
        }

        [data-theme="light"] {
            --bg: #f0f2f5;
            --card: #ffffff;
            --primary: #4a6cf7;
            --accent: #3653d1;
            --text: #333333;
            --text-dim: #888;
            --border: #ddd;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Outfit', sans-serif; 
            background: var(--bg); 
            color: var(--text);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        nav {
            padding: 20px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            background: var(--card);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo { font-size: 24px; font-weight: 900; letter-spacing: -1px; color: var(--primary); text-decoration: none; }
        .nav-btns { display: flex; gap: 10px; align-items: center; }
        
        .btn {
            background: var(--border);
            color: var(--text);
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn:hover { background: var(--primary); color: #000; }

        .container { padding: 50px 5%; max-width: 1400px; margin: 0 auto; }
        h1 { font-size: 48px; margin-bottom: 20px; }
        h2.section-title { font-size: 32px; margin: 40px 0 20px 0; color: var(--text-dim); }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .item-card {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 30px;
            border-radius: 15px;
            text-decoration: none;
            color: var(--text);
            transition: all 0.3s ease;
            position: relative;
        }

        .item-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 242, 255, 0.1);
        }

        .item-card h3 { font-size: 20px; margin-bottom: 10px; text-transform: uppercase; }
        .item-card span { font-size: 12px; color: var(--text-dim); display: block; }

        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-box {
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--primary);
            max-width: 500px;
            width: 100%;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .close-x {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 24px;
            cursor: pointer;
        }
        .close-x:hover { color: var(--primary); }

        .modal-box h2 { margin-bottom: 20px; color: var(--primary); }
        .modal-box p { font-size: 14px; line-height: 1.6; margin-bottom: 15px; color: var(--text-dim); text-align: left; }
        .modal-box a { color: var(--primary); text-decoration: none; font-weight: bold; }
        
        select {
            margin: 20px 0;
            padding: 10px;
            width: 100%;
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 5px;
        }

        .loader { font-size: 20px; color: var(--primary); font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>

    <nav>
        <a href="#" class="logo">EZcript</a>
        <div class="nav-btns">
            <a href="https://github.com/Stormwindsky/EZcript" target="_blank" class="btn">GitHub</a>
            <button class="btn" onclick="openModal('modal-credits')" id="btn-credits">Credits</button>
            <button class="btn" onclick="toggleTheme()" id="theme-btn">üåô</button>
            <button class="btn" onclick="openModal('modal-settings')" id="btn-settings">Settings</button>
        </div>
    </nav>

    <div class="container">
        <h1 id="main-title">Available Services</h1>
        <div id="loader" class="loader">SCANNING API...</div>
        <div class="grid" id="grid"></div>

        <h2 class="section-title" id="template-title">Available Templates</h2>
        <div id="loader-templates" class="loader">SCANNING TEMPLATES...</div>
        <div class="grid" id="grid-templates"></div>
    </div>

    <div id="modal-settings" class="modal-overlay">
        <div class="modal-box">
            <button class="close-x" onclick="closeModal('modal-settings')">&times;</button>
            <h2 id="modal-h-settings">Settings</h2>
            <select id="lang" onchange="updateLang(this.value)">
                <option value="en">English</option>
                <option value="fr">Fran√ßais</option>
            </select>
            <button class="btn" style="width:100%" onclick="closeModal('modal-settings')">Close</button>
        </div>
    </div>

    <div id="modal-credits" class="modal-overlay">
        <div class="modal-box">
            <button class="close-x" onclick="closeModal('modal-credits')">&times;</button>
            <h2 id="modal-h-credits">Notes & Credits</h2>
            <div id="credits-content"></div>
            <button class="btn" style="width:100%; margin-top:20px;" onclick="closeModal('modal-credits')">Close</button>
        </div>
    </div>

    <script>
        const owner = "stormwindsky";
        const repo = "EZcript";
        const basePath = "Lists";
        
        // CONFIGURATION DES TEMPLATES
        const templateRepo = "Template-EZcript-Projects";
        const templatePath = "templates projects";
        
        // MAPPING DES EXTENSIONS : Facile √† configurer
        const extensionMap = {
            ".ezpy": "EZpy/EZpy.html",
            ".ezhtml": "EZHTML/EZHTML.html",
            ".ezjson": "EZjson/EZjson.html"
            ".ezerjs": "EZerscript/EZerscript.html"
        };

        const langData = {
            en: { 
                title: "Available Services", 
                templates: "Available Templates",
                settings: "Settings", 
                load: "SCANNING API...", 
                close: "Close",
                credits: "Notes & Credits",
                desc: "EZcript is an open source website that makes it easy to create visual maneuvering scripts created by Stormwindsky.",
                license: "The website is licensed under <b>MIT</b>, but the visual scripting system <b>Blockly</b> (created by MIT & Google) is licensed under the <b>Apache-2.0</b> license.",
                links: "Links:"
            },
            fr: { 
                title: "Services Disponibles", 
                templates: "Mod√®les Disponibles",
                settings: "Param√®tres", 
                load: "RECHERCHE API...", 
                close: "Fermer",
                credits: "Notes & Cr√©dits",
                desc: "EZcript est un site open source cr√©√© par Stormwindsky qui facilite la cr√©ation de scripts de man≈ìuvre visuels.",
                license: "Le site web est sous licence <b>MIT</b>, mais le syst√®me de script visuel <b>Blockly</b> (cr√©√© par MIT & Google) est sous licence <b>Apache-2.0</b>.",
                links: "Liens :"
            }
        };

        function applyGlobalSettings() {
            const theme = localStorage.getItem('ez_theme') || 'dark';
            const lang = localStorage.getItem('ez_lang') || 'en';

            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('theme-btn').innerText = theme === 'dark' ? "üåô" : "‚òÄÔ∏è";
            
            const d = langData[lang];
            document.getElementById('main-title').innerText = d.title;
            document.getElementById('template-title').innerText = d.templates;
            document.getElementById('btn-settings').innerText = d.settings;
            document.getElementById('modal-h-settings').innerText = d.settings;
            document.getElementById('btn-credits').innerText = d.credits;
            document.getElementById('modal-h-credits').innerText = d.credits;
            document.getElementById('lang').value = lang;

            document.getElementById('credits-content').innerHTML = `
                <p>${d.desc}</p>
                <p>${d.license}</p>
                <p><b>${d.links}</b><br>
                   ‚Ä¢ <a href="http://developers.google.com/blockly" target="_blank">Official Blockly</a><br>
                   ‚Ä¢ <a href="https://github.com/RaspberryPiFoundation/blockly" target="_blank">Blockly Source</a><br>
                   ‚Ä¢ <a href="https://github.com/Stormwindsky/EZcript" target="_blank">EZcript Repository</a>
                </p>
            `;
        }

        function toggleTheme() {
            const current = localStorage.getItem('ez_theme') || 'dark';
            const next = current === 'dark' ? 'light' : 'dark';
            localStorage.setItem('ez_theme', next);
            applyGlobalSettings();
        }

        function updateLang(l) {
            localStorage.setItem('ez_lang', l);
            applyGlobalSettings();
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // SCAN DES SERVICES (Inchang√©)
        async function scanFiles() {
            const grid = document.getElementById('grid');
            const loader = document.getElementById('loader');
            try {
                const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${basePath}`);
                const folders = await res.json();
                for (const item of folders) {
                    if (item.type === 'dir') {
                        const subRes = await fetch(item.url);
                        const files = await subRes.json();
                        files.forEach(file => {
                            if (file.name.endsWith('.html')) {
                                createCard(file.name.replace('.html', ''), item.name, file.name, 'grid');
                            }
                        });
                    }
                }
                loader.style.display = 'none';
            } catch (e) {
                loader.innerText = "Error loading files.";
            }
        }

        // SCAN DES TEMPLATES (Nouveau)
        async function scanTemplates() {
            const grid = document.getElementById('grid-templates');
            const loader = document.getElementById('loader-templates');
            try {
                const res = await fetch(`https://api.github.com/repos/${owner}/${templateRepo}/contents/${encodeURIComponent(templatePath)}`);
                const files = await res.json();
                
                files.forEach(file => {
                    // On v√©rifie si l'extension est dans notre extensionMap
                    const ext = Object.keys(extensionMap).find(e => file.name.endsWith(e));
                    
                    if (ext) {
                        const name = file.name.replace(ext, '');
                        const rawUrl = `https://raw.githubusercontent.com/${owner}/${templateRepo}/main/${encodeURIComponent(templatePath)}/${file.name}`;
                        const editorPath = extensionMap[ext];
                        const finalHref = `https://${owner}.github.io/${repo}/Lists/${editorPath}?=${rawUrl}`;
                        
                        createTemplateCard(name, ext.replace('.','').toUpperCase(), finalHref);
                    }
                });
                loader.style.display = 'none';
            } catch (e) {
                console.error(e);
                loader.innerText = "No templates found or API limit reached.";
            }
        }

        function createCard(name, folder, fullName, targetGridId) {
            const grid = document.getElementById(targetGridId);
            const card = document.createElement('a');
            card.className = 'item-card';
            card.href = `https://${owner}.github.io/${repo}/${basePath}/${folder}/${fullName}`;
            card.innerHTML = `
                <span>Service / ${folder}</span>
                <h3>${name}</h3>
                <p style="color:var(--primary); font-size:13px; font-weight:bold;">Launch Module ‚Üí</p>
            `;
            grid.appendChild(card);
        }

        function createTemplateCard(name, type, url) {
            const grid = document.getElementById('grid-templates');
            const card = document.createElement('a');
            card.className = 'item-card';
            card.href = url;
            card.innerHTML = `
                <span>Template / ${type}</span>
                <h3>${name}</h3>
                <p style="color:var(--accent); font-size:13px; font-weight:bold;">Use Template ‚Üí</p>
            `;
            grid.appendChild(card);
        }

        applyGlobalSettings();
        scanFiles();
        scanTemplates();
    </script>
</body>
</html>
